---
title: "03 Data wrangling"
author: "Anjali Kabra"
date: "2023-04"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    collapsed: false
    number_sections: true
    toc_depth: 3
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

# Data Wrangling

Last compiled: `r Sys.Date()`

I had to use the reduced data, because my computer coudn't load the original patent data.

# Challange Nr. 1
## Patent Dominance

Table 1: The 10 US companies with the most patents(descending order).
```{r}
library(vroom)
library(tidyverse)

col_types <- list(
  id = col_character(),
  date = col_date("%Y-%m-%d"),
  num_claims = col_double()
)

patent_tbl <- vroom(
  file       = "C:/Programming/R/data science basics/Patent_data_reduced/patent.tsv", 
  delim      = "\t", 
  col_types  = col_types,
  na         = c("", "NA", "NULL")
)

col_types <- list(
  id = col_character(),
  type = col_character(),
  organization = col_character()
)

assignee_tbl <- vroom(
  file       = "C:/Programming/R/data science basics/Patent_data_reduced/assignee.tsv", 
  delim      = "\t", 
  col_types  = col_types,
  na         = c("", "NA", "NULL")
)

col_types <- list(
  patent_id = col_character(),
  assignee_id = col_character()
)

patent_assignee_tbl <- vroom(
  file       = "C:/Programming/R/data science basics/Patent_data_reduced/patent_assignee.tsv", 
  delim      = "\t", 
  col_types  = col_types,
  na         = c("", "NA", "NULL")
)

col_types <- list(
  patent_id = col_character(),
  mainclass_id = col_character(),
  sequence = col_integer()
)

uspc_tbl <- vroom(
  file       = "C:/Programming/R/data science basics/Patent_data_reduced/uspc.tsv", 
  delim      = "\t", 
  col_types  = col_types,
  na         = c("", "NA", "NULL")
)

US_top_10 <- patent_assignee_tbl %>%
  group_by(assignee_id) %>%
  summarize(count = n()) %>%
  arrange(desc(count)) %>%
  left_join(assignee_tbl, c("assignee_id" = "id"))

Challange_1 <- US_top_10$organization %>%
  head(n=10)
Challange_1
```

# Challange Nr. 2
## Recent Patent Activity (2014 Aug)

Table 2: Top 10 US companies with the most new granted patents in 2014 Aug.
```{r}
US_2014_05 <- patent_tbl %>%
  filter(date >= "2014-05-01" & date < "2014-06-01") %>%
  left_join(patent_assignee_tbl, c("id" = "patent_id")) %>%
  left_join(assignee_tbl, c("assignee_id" = "id")) %>%
  drop_na() %>%
  group_by(organization) %>%
  summarize(count =n()) %>%
  arrange(desc(count))

Challange_2 <-US_2014_05$organization %>%
  head(n=10)
Challange_2
```

# Challange Nr. 3
## Innovation in Tech

Table 3: The top 5 USPTO mainclasses for the worlds top 10 companies.(descending order)
```{r}
world_top_10 <- uspc_tbl %>%
  inner_join(patent_assignee_tbl, c("patent_id" = "patent_id")) %>%
  inner_join(assignee_tbl, c("assignee_id"= "id")) %>%
  group_by(organization) %>%
  summarize(count = n()) %>%
  arrange(desc(count)) %>%
  head(n=10)


Top_mainclasses <- uspc_tbl %>%
  inner_join(patent_assignee_tbl, c("patent_id" = "patent_id")) %>%
  inner_join(assignee_tbl, c("assignee_id"= "id")) %>%
  subset(organization %in% world_top_10$organization) %>%
  group_by(mainclass_id) %>%
  summarize(count = n()) %>%
  arrange(desc(count)) %>%
  head(n=5)
Challange_3 <- Top_mainclasses$mainclass_id %>%
  head(n=5)
Challange_3
```
